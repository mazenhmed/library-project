<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุชุญูู - ุงูููุชุจุฉ ุงููุชูุงููุฉ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-style.css') }}">
</head>

<body>
    <script>
        // ุญูุงูุฉ ุงูุตูุญุฉ: ุงูุชุญูู ูู ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ
        function checkAdminAuth() {
            const localAuth = localStorage.getItem('adminAuth');
            const sessionAuth = sessionStorage.getItem('adminAuth');

            if (!localAuth && !sessionAuth) {
                // ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุฏุฎููุ ุฅุนุงุฏุฉ ุงูุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู
                window.location.href = "{{ url_for('admin_login') }}";
                return false;
            }

            const authData = JSON.parse(localAuth || sessionAuth);
            if (!authData.isLoggedIn) {
                window.location.href = "{{ url_for('admin_login') }}";
                return false;
            }

            return true;
        }

        // ูุญุต ุงูุตูุงุญูุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        if (!checkAdminAuth()) {
            document.body.style.display = 'none';
        }
    </script>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="ุดุนุงุฑ ุงูููุชุจุฉ ุงููุชูุงููุฉ"
                    class="logo-image" style="width: 70px; height: 70px; object-fit: contain; margin-bottom: 10px;">
                <h2>ููุญุฉ ุงูุชุญูู</h2>
                <p style="font-size: 0.875rem; color: #94a3b8; margin-top: 0.5rem;" id="adminUsername"></p>
            </div>
            <nav class="admin-nav">
                <a href="{{ url_for('index') }}" class="nav-item">๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
                <a href="#" class="nav-item active" onclick="showSection('products')">๐ฆ ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</a>
                <a href="#" class="nav-item" onclick="showSection('categories')">๐ ุฅุฏุงุฑุฉ ุงูุฃูุณุงู</a>
                <a href="#" class="nav-item" onclick="showSection('ads')">๐จ ุงูุฅุนูุงูุงุช ูุงูุนุฑูุถ</a>
                <a href="#" class="nav-item" onclick="showSection('orders')">๐ ุงูุทูุจุงุช</a>
                <a href="#" class="nav-item" onclick="logout()" style="color: #ef4444; margin-top: auto;">๐ช ุชุณุฌูู
                    ุงูุฎุฑูุฌ</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1 id="sectionTitle">ุฅุฏุงุฑุฉ ุงูููุชุฌุงุช</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ
                    </button>
                </div>
            </header>

            <!-- Products Section -->
            <section id="productsSection" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">๐ฆ</div>
                        <div class="stat-info">
                            <h3 id="totalProducts">0</h3>
                            <p>ุฅุฌูุงูู ุงูููุชุฌุงุช</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">๐</div>
                        <h3 id="totalCategories">6</h3>
                        <p>ุงูุฃูุณุงู</p>
                    </div>
                </div>

                <div class="products-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ุงูุตูุฑุฉ</th>
                                <th>ุงุณู ุงูููุชุฌ</th>
                                <th>ุงูุณุนุฑ</th>
                                <th>ุงููุณู</th>
                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Ads Section -->
            <section id="adsSection" class="content-section">
                <div class="ads-container">
                    <div class="section-card">
                        <h2>ุงูุตูุฑ ุงูุฅุนูุงููุฉ</h2>
                        <button class="btn btn-primary" onclick="showAddAdModal()">โ ุฅุถุงูุฉ ุฅุนูุงู</button>
                        <div id="adsList" class="ads-list"></div>
                    </div>

                    <div class="section-card">
                        <h2>ุงูุนุฑูุถ ุงูุฎุงุตุฉ</h2>
                        <button class="btn btn-primary" onclick="showAddOfferModal()">โ ุฅุถุงูุฉ ุนุฑุถ</button>
                        <div id="offersList" class="offers-list"></div>
                    </div>
                </div>
            </section>

            <!-- Categories Management Section -->
            <section id="categoriesSection" class="content-section">
                <div class="section-card">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2>ุฅุฏุงุฑุฉ ุงูุฃูุณุงู</h2>
                        <button class="btn btn-primary" onclick="showAddCategoryModal()">โ ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ</button>
                    </div>
                    <div id="categoriesList" class="categories-list"></div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="ordersSection" class="content-section">
                <div class="orders-container">
                    <h2>ุงูุทูุจุงุช ุงูุฃุฎูุฑุฉ</h2>
                    <p style="color: #94a3b8; text-align: center; padding: 2rem;">
                        ูุง ุชูุฌุฏ ุทูุจุงุช ุญุงููุงู
                    </p>
                </div>
            </section>
        </main>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h2>
                <button class="close-btn" onclick="closeProductModal()">ร</button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">

                <div class="form-group">
                    <label>ุงุณู ุงูููุชุฌ *</label>
                    <input type="text" id="productName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>ุงูุณุนุฑ (ุฑูุงู ูููู) *</label>
                        <input type="number" id="productPrice" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label>ุงููุณู *</label>
                        <select id="productCategory" required>
                            <!-- Categories will be loaded dynamically -->
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>ุตูุฑุฉ ุงูููุชุฌ</label>
                    <input type="file" id="productImageFile" accept="image/*" onchange="handleImageUpload(event)">
                    <small style="color: #64748b; display: block; margin-top: 0.5rem;">ุฃู ุฃุฏุฎู ุฑุงุจุท ุงูุตูุฑุฉ ุฃู ุฑูุฒ
                        ุชุนุจูุฑู</small>
                </div>

                <div class="form-group">
                    <label>ุฑุงุจุท ุงูุตูุฑุฉ ุฃู ุงูุฑูุฒ ุงูุชุนุจูุฑู</label>
                    <input type="text" id="productImage" placeholder="ูุซุงู: ๐ ุฃู https://example.com/image.jpg">
                    <div id="imagePreview" style="margin-top: 1rem; display: none;">
                        <img id="previewImg"
                            style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid #e2e8f0;" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeProductModal()">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ ุงูููุชุฌ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Advertisement Modal -->
    <div id="adModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="adModalTitle">ุฅุถุงูุฉ ุฅุนูุงู ุฌุฏูุฏ</h2>
                <button class="close-btn" onclick="closeAdModal()">ร</button>
            </div>
            <form id="adForm" onsubmit="saveAd(event)">
                <input type="hidden" id="adIndex">

                <div class="form-group">
                    <label>ุนููุงู ุงูุฅุนูุงู *</label>
                    <input type="text" id="adTitle" required>
                </div>

                <div class="form-group">
                    <label>ูุตู ุงูุฅุนูุงู *</label>
                    <textarea id="adDescription" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label>ุตูุฑุฉ ุงูุฅุนูุงู</label>
                    <input type="file" id="adImageFile" accept="image/*" onchange="handleAdImageUpload(event)">
                    <small style="color: #64748b; display: block; margin-top: 0.5rem;">ุฃู ุฃุฏุฎู ุฑุงุจุท ุงูุตูุฑุฉ ุฃู ุฑูุฒ
                        ุชุนุจูุฑู</small>
                </div>

                <div class="form-group">
                    <label>ุฑุงุจุท ุงูุตูุฑุฉ ุฃู ุงูุฑูุฒ ุงูุชุนุจูุฑู</label>
                    <input type="text" id="adIcon" placeholder="ูุซุงู: ๐ ุฃู https://example.com/image.jpg">
                    <div id="adImagePreview" style="margin-top: 1rem; display: none;">
                        <img id="adPreviewImg"
                            style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid #e2e8f0;" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeAdModal()">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ ุงูุฅุนูุงู</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Offer Modal -->
    <div id="offerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="offerModalTitle">ุฅุถุงูุฉ ุนุฑุถ ุฌุฏูุฏ</h2>
                <button class="close-btn" onclick="closeOfferModal()">ร</button>
            </div>
            <form id="offerForm" onsubmit="saveOffer(event)">
                <input type="hidden" id="offerIndex">

                <div class="form-group">
                    <label>ุนููุงู ุงูุนุฑุถ *</label>
                    <input type="text" id="offerTitle" required>
                </div>

                <div class="form-group">
                    <label>ุชูุงุตูู ุงูุนุฑุถ *</label>
                    <textarea id="offerDiscount" rows="3" required
                        placeholder="ูุซุงู: ุฎุตู 20% ุนูู ุฌููุน ุงูุฃููุงู"></textarea>
                </div>

                <div class="form-group">
                    <label>ุตูุฑุฉ ุงูุนุฑุถ</label>
                    <input type="file" id="offerImageFile" accept="image/*" onchange="handleOfferImageUpload(event)">
                    <small style="color: #64748b; display: block; margin-top: 0.5rem;">ุฃู ุฃุฏุฎู ุฑุงุจุท ุงูุตูุฑุฉ ุฃู ุฑูุฒ
                        ุชุนุจูุฑู</small>
                </div>

                <div class="form-group">
                    <label>ุฑุงุจุท ุงูุตูุฑุฉ ุฃู ุงูุฑูุฒ ุงูุชุนุจูุฑู</label>
                    <input type="text" id="offerIcon" placeholder="ูุซุงู: ๐ ุฃู https://example.com/image.jpg">
                    <div id="offerImagePreview" style="margin-top: 1rem; display: none;">
                        <img id="offerPreviewImg"
                            style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid #e2e8f0;" />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeOfferModal()">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ ุงูุนุฑุถ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="categoryModalTitle">ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ</h2>
                <button class="close-btn" onclick="closeCategoryModal()">ร</button>
            </div>
            <form id="categoryForm" onsubmit="saveCategory(event)">
                <input type="hidden" id="categoryIndex">

                <div class="form-group">
                    <label>ุงุณู ุงููุณู *</label>
                    <input type="text" id="categoryName" required>
                </div>

                <div class="form-group">
                    <label>ุฃููููุฉ ุงููุณู (ุฑูุฒ ุชุนุจูุฑู)</label>
                    <input type="text" id="categoryIcon" placeholder="ูุซุงู: โ๏ธ">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">ุฅูุบุงุก</button>
                    <button type="submit" class="btn btn-primary">ุญูุธ ุงููุณู</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>

</html>